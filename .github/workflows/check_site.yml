name: Monitor Docript

on:
  schedule:
    - cron: '*/1 * * * *'
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Check Site Status
        id: check_site
        continue-on-error: true
        run: |
          STATUS=$(curl -o /dev/null -s -w "%{http_code}" --max-time 10 https://docript.fr || echo "000")
          echo "status=$STATUS" >> $GITHUB_OUTPUT
          if [ "$STATUS" != "200" ]; then
            exit 1
          fi

      - name: Send Notification
        if: steps.check_site.outcome == 'failure'
        run: |
          curl -d "ðŸš¨ Le site Docript est DOWN ! (Status: ${{ steps.check_site.outputs.status }})" \
          https://ntfy.sh/site_docript_bapwep_098465874995322647821154477885

      - name: Success
        if: steps.check_site.outcome == 'success'
        run: exit 0
