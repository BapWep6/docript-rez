name: Monitor Docript

on:
  schedule:
    - cron: '*/1 * * * *'
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Check Site Status
        id: check_site
        continue-on-error: true
        run: |
          STATUS=$(curl -o /dev/null -s -w "%{http_code}" --max-time 10 https://docript.fr || echo "000")
          echo "status=$STATUS" >> $GITHUB_OUTPUT
          if [ "$STATUS" != "200" ]; then
            exit 1
          fi

      - name: Send Notification
        if: steps.check_site.outcome == 'failure'
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d "{\"content\": \"ðŸš¨ **ALERTE** : Le site Docript est DOWN ! \nStatus: ${{ steps.check_site.outputs.status }}\"}" \
          "VOTRE_URL_WEBHOOK_ICI"

      - name: Success
        if: steps.check_site.outcome == 'success'
        run: exit 0
